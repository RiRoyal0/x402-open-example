services:
  gateway1:
    build: .
    command: ["node", "gateway.js"]
    environment:
      - GATEWAY_PORT=8081
    ports:
      - "8081:8081"
    restart: unless-stopped

  gateway2:
    build: .
    command: ["node", "gateway.js"]
    environment:
      - GATEWAY_PORT=8082
    ports:
      - "8082:8082"
    restart: unless-stopped

  nodea:
    build: .
    command: ["node", "nodeA.js"]
    environment:
      - PRIVATE_KEY=${PRIVATE_KEY}
      # - SOLANA_PRIVATE_KEY=${SOLANA_PRIVATE_KEY}
      - GATEWAY_URLS=http://gateway1:8081/facilitator,http://gateway2:8082/facilitator
      - NODE_BASE_URL=http://nodea:4101/facilitator
    ports:
      - "4101:4101"
    restart: unless-stopped

  nodeb:
    build: .
    command: ["node", "nodeB.js"]
    environment:
      - PRIVATE_KEY=${PRIVATE_KEY}
      # - SOLANA_PRIVATE_KEY=${SOLANA_PRIVATE_KEY}
      - GATEWAY_URLS=http://gateway1:8081/facilitator,http://gateway2:8082/facilitator
      - NODE_BASE_URL=http://nodeb:4102/facilitator
    ports:
      - "4102:4102"
    restart: unless-stopped

  nodec:
    build: .
    command: ["node", "nodeC.js"]
    environment:
      - PRIVATE_KEY=${PRIVATE_KEY}
      # - SOLANA_PRIVATE_KEY=${SOLANA_PRIVATE_KEY}
      - GATEWAY_URLS=http://gateway1:8081/facilitator,http://gateway2:8082/facilitator
      - NODE_BASE_URL=http://nodec:4103/facilitator
    ports:
      - "4103:4103"
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    depends_on:
      - gateway1
      - gateway2
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "80:80"
      - "8080:8080"
    restart: unless-stopped

networks:
  default:
    name: x402-net


